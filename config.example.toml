# Open Gateway Configuration
# This configuration shows both single-server (backward compatible) and
# multi-server configurations. Use either `[server]` OR `[[servers]]`.

# Option 1: Single server configuration (backward compatible)
# [server]
# host = "0.0.0.0"
# port = 8080
# timeout = 30

# Option 2: Multiple servers configuration
# Each server can have its own routes. If no routes are specified,
# all enabled routes are used for that server.

[[servers]]
name = "api-server"
host = "0.0.0.0"
port = 8080
timeout = 30
routes = ["api-v1", "api-v2"]  # Reference routes by name or path

[[servers]]
name = "admin-server"
host = "0.0.0.0"
port = 9090
timeout = 30
# No routes specified - uses all enabled routes

[metrics]
enabled = true
path = "/metrics"

[health]
enabled = true
path = "/health"

# Master Access Token Guard Configuration
# When enabled, all requests must include a valid token in the specified header
# to access the gateway. This protects the gateway from unauthorized access.
[master_access_token]
enabled = false  # Set to true to enable the guard
header_name = "Authorization"  # Header name to check for the token
tokens = [
    # "Bearer your-secret-token-1",
    # "Bearer your-secret-token-2",
]

# Route configurations
# Routes can have a `name` field to be referenced by servers
[[routes]]
name = "api-v1"
path = "/api/v1/*"
target = "http://localhost:3001"
strip_prefix = true
methods = ["GET", "POST", "PUT", "DELETE"]
api_key_pool = "default"
description = "API v1 routes"
enabled = true

[[routes]]
name = "api-v2"
path = "/api/v2/*"
target = "http://localhost:3002"
strip_prefix = true
description = "API v2 routes"
enabled = true

[[routes]]
name = "admin"
path = "/admin/*"
target = "http://localhost:4000"
strip_prefix = true
description = "Admin routes"
enabled = true

# API Key Pools
[api_key_pools.default]
strategy = "round_robin"  # Options: round_robin, random, weight
header_name = "X-API-Key"
keys = [
    { key = "api-key-1", weight = 1, enabled = true },
    { key = "api-key-2", weight = 2, enabled = true },
    { key = "api-key-3", weight = 1, enabled = true },
]

[api_key_pools.openai]
strategy = "weight"
header_name = "Authorization"
keys = [
    { key = "Bearer sk-key-1", weight = 3, enabled = true },
    { key = "Bearer sk-key-2", weight = 1, enabled = true },
]
